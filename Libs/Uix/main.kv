#:kivy 1.10.0

#########################################################
#                                                       #
#                   COLORS                              #
#                                                       #
#########################################################
# define used colors
#: set color1 (0.965, 0.965, 0.965)  #hex F5F5F5
#: set color2 (0.325, 0.553, 0.683)  #hex 538DDC
#: set color_white (1, 1, 1)
#: set color_black (0, 0, 0)
#: set color_silver (0.5, 0.5, 0.5)
#: set color_silver_dark (0.25, 0.25, 0.25)
#: set color_silver_light (0.75, 0.75, 0.75)

#: set color1_rgba (0.965, 0.965, 0.965, 1)
#: set color2_rgba (0.325, 0.553, 0.683, 1)
#: set clear_color (0, 0, 0, 0)
#: set color_white_rgba (1, 1, 1, 1)
#: set color_black_rgba (0, 0, 0, 1)
#: set color_silver_rgba (0.5, 0.5, 0.5, 1)
#: set color_silver_dark_rgba (0.25, 0.25, 0.25, 1)
#: set color_sizver_light_rgba (0.75, 0.75, 0.75, 1)

#: set text_color_white (1, 1, 1, 1)
#: set text_color_black (0, 0, 0, 1)
#: set text_color1 (0.965, 0.965, 0.965, 1)
#: set text_color2 (0.325, 0.553, 0.683, 1)


#########################################################
#                                                       #
#                   WELCOME SCREEN DEPENDENCY           #
#                                                       #
#########################################################

<WelcomeScreenSessionListItemView@RecycleDataViewBehavior+Button>:
    background_down: ""
    background_normal: ""
    on_press: root.selected = not root.selected
    canvas:
        Color:
            rgb: color2 if root.selected else color1 # cell bg color
            a: 1
        Rectangle:
            size: self.size
            pos: self.pos
# session general info
    filename: "fileName"
    patient_name: "patientName"
    filepath: "filePath"
# default cell celected state
    selected: False

# cell image border
    RelativeLayout:
        x: self.parent.x
        y: self.parent.y
        height: self.parent.height
        width: self.height
# cell image
        RelativeLayout:
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            size_hint: 0.9, 0.9
            Image:
                size_hint: 1, 1
                source: 'Libs/Resources/brain.png'
# cell text box
    RelativeLayout:
        x: self.parent.x + self.parent.height
        y: self.parent.y
        height: self.parent.height
        width: self.parent.width - self.parent.height
        BoxLayout:
            orientation: 'vertical'
            Label:
                text: root.filename
                bold: 1
                text_size: self.size
                haling: 'right'
                color: text_color_white if root.selected else text_color_black
            Label:
                text: root.patient_name
                bold: 1
                text_size: self.size
                haling: 'right'
                color: text_color_white if root.selected else text_color_black
            Label:
                text: root.filepath
                bold: 0
                text_size: self.size
                haling: 'right'
                color: text_color_white if root.selected else text_color_black



<WelcomeScreenSessionRecycleView@RecycleView>:
    canvas.before:
        Color:
            rgb: color1
            a:1
        Rectangle:
            size: self.size
            pos: self.pos
    viewclass: 'WelcomeScreenSessionListItemView'
    data : [{'filename': str(x)} for x in range(100)]
    RecycleBoxLayout:
        default_size: None, sp(60)
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'


#############################################
#                                           #
#            WELCOME SCREEN                 #
#                                           #
#############################################


<WelcomeScreen>:
    RelativeLayout:
        pos_hint: {'x': 0, 'y': 0}
        size_hint: 0.6, 1
        canvas:
            Color:
                rgb: color1
                a: 1
            Rectangle:
                size: self.size
        RelativeLayout:
            size_hint: 0.4, 0.6
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            BoxLayout:
                orientation: "vertical"
                Image:
                    size_hint: 1, 0.4/0.6
                    source: 'Libs/Resources/brain.png'
                Label:
                    id: AppNameLabel
                    size_hint: 1, None
                    height: sp(30)
                    text: 'pyMRI'
                    font_size: 30
                    bold: 1
                    color: text_color_black
                Button:
                    size_hint: 1, None
                    height: sp(32)
                    id: CreateNewSessionButtonID
                    background_normal: ''
                    background_down: ''
                    background_color: clear_color
                    color: text_color_black
                    text: "create new session"
                    on_press: self.background_color = color2_rgba; app.route = "/workspace"
                    on_release: self.background_color = clear_color; root.createNewSessionButtonReleased()

    RelativeLayout:
        pos_hint: {'x': .6, 'y': 0}
        size_hint: .4, 1
        BoxLayout:
            orientation: "vertical"
            WelcomeScreenSessionRecycleView:
                size_hint: 1, None
                height: self.parent.height - OpenExistSessionButtonID.height
            Button:
                size_hint: 1, None
                height: sp(32)
                id: OpenExistSessionButtonID
                background_normal: ''
                background_down: ''
                background_color: color1_rgba
                text: 'open exist session'
                color: text_color_black
                on_press: self.background_color = color2_rgba
                on_release: self.background_color = color1_rgba; root.openExistSessionButtonReleased()


#############################################
#                                           #
#     WORKSPACE SCREEN DEPENDENCY           #
#                                           #
#############################################

<WorkspaceScreenTopTabBarItem@Button>:
    background_normal: ''
    background_down: ''
    label_text: ""
    image_source: ""
    background_color: clear_color
    selected_color: color2_rgba
    BoxLayout:
        canvas:
            Color:
                rgba: root.selected_color if root.state == 'down' else clear_color
            Rectangle:
                pos: self.center_x - (self.width * 0.9)/2., self.center_y - (self.height * 0.9) /2.
                size: self.width * 0.9, self.height * 0.9
        height: self.parent.height
        width: self.parent.width
        pos: self.parent.pos
        padding: 0, self.height * 0.1, 0, 0
        orientation: "vertical"
        Image:
            size_hint: 1, .5
            source: root.image_source
        Label:
            size_hint: 1, 0.4
            color: text_color_black
            font_size: sp(12)
            text: root.label_text


<JSearchBar@Widget>:

    search_text: ""
    hint_text: ""
    canvas:
        Color:
            rgb: color1
            a: 1
        Rectangle:
            size: self.size
            pos: self.pos
    BoxLayout:
        size: self.parent.size
        pos: self.parent.pos
        orientation: "horizontal"
        Image:
            id:SearchBarSearch
            size_hint: None, 1
            width: self.height
            source: 'Libs/Resources/JSearchBarFilterIcon.png'
        TextInput:
            id: SearchTextInput
            size_hint: None, 1
            width: self.parent.width - (SearchBarClear.width if SearchBarClear.opacity else 0) - SearchBarSearch.width
            on_text: root.search_text = self.text
            hint_text: root.hint_text
            multiline: False
            color: text_color_black
        Button:
            id: SearchBarClear
            size_hint: None, 1
            opacity: 1 if root.search_text != "" else 0
            width: self.height if self.opacity else 0
            on_press: SearchTextInput.text = ""
            background_normal: 'Libs/Resources/JSearchBarClearIcon.png'
            border: 0, 0, 0, 0

<WorkspaceScreenMediaLibraryRecycleView@RecycleView>:
    element_size: None, sp(40)
    canvas.before:
        Color:
            rgb: color1
            a:1
        Rectangle:
            size: self.size
            pos: self.pos
    viewclass: 'WorkspaceScreenMediaLibraryListItemView'
    RecycleBoxLayout:
        default_size: root.element_size
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'

<WorkspaceScreenMediaLibraryListItemView@Button>:
    index_path: 0
    label_text: "Slice"
    background_color: (clear_color if root.index_path % 2 == 0 else color_silver_rgba) if self.state == "normal" else color2_rgba
    background_normal: ""
    background_down: ""
    BoxLayout:
        size: self.parent.size
        pos: self.parent.pos
        orientation: "horizontal"
        Image:
            size_hint: None, 1
            width: self.parent.height
            source: "Libs/Resources/workspacescreen_medialibrary_item_default_icon.png"

        Label:
            markup: True
            text: root.label_text
            color: text_color_black




<WorkspaceScreenSegmentsRecycleView@RecycleView>:
    element_size: None, sp(40)
    canvas.before:
        Color:
            rgb: color1
            a: 1
        Rectangle:
            size: self.size
            pos: self.pos
    viewclass: 'WorkspaceScreenSegmentsListItemView'
    data : [{'label_text': "Segment #" + str(x), 'index_path': x} for x in range(3)]
    RecycleBoxLayout:
        default_size: root.element_size
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'

<WorkspaceScreenSegmentsListItemView@Button>:
    index_path: 0
    label_text: "Slice"
    background_color: (clear_color if root.index_path % 2 == 0 else color_silver_rgba) if self.state == "normal" else color2_rgba
    background_normal: ""
    background_down: ""
    BoxLayout:
        size: self.parent.size
        pos: self.parent.pos
        orientation: "horizontal"
        Image:
            size_hint: None, 1
            width: self.parent.height
            source: "Libs/Resources/workspacescreen_segments_item_default_icon.png"

        Label:
            text: root.label_text
            color: text_color_black

<WorkspaceScreenPatientInfoListItemView@Label>:
    index_path: 0
    name: "name"
    description: "description"
    canvas:
        Color:
            rgb: color1 if self.index_path % 2 == 0 else color_silver
            a: 1
        Rectangle:
            size: self.size
            pos: self.pos
    BoxLayout:
        size: self.parent.size
        pos: self.parent.pos
        orientation: "horizontal"
        Label:
            text: root.name
            color: text_color_black

        Label:
            text: root.description
            color: text_color_black

<WorkspaceScreenMRIInfoListItemView@Label>:
    index_path: 0
    name: "name"
    description: "description"
    canvas:
        Color:
            rgb: color1 if self.index_path % 2 == 0 else color_silver
            a: 1
        Rectangle:
            size: self.size
            pos: self.pos
    BoxLayout:
        size: self.parent.size
        pos: self.parent.pos
        orientation: "horizontal"
        Label:
            text: root.name
            color: text_color_black

        Label:
            text: root.description
            color: text_color_black

#################################################
#                                               #
#               WORKSPACE SCREEN                #
#                                               #
#################################################


<WorkspaceScreen>:
    RelativeLayout:
        size: self.parent.size
        # top panel
        TabbedPanel:
            canvas:
                Color:
                    rgb: color2
                    a: 1
                Rectangle:
                    size: self.size
                    pos: self.pos
            id: MainMenuTabbedPanel
            element_default_width: sp(75)
            element_default_height: sp(75)
            tab_height: sp(25)
            size_hint: 1, None
            height: (self.element_default_height + self.tab_height)
            pos_hint: {'x': 0, 'y': ((self.parent.height - self.height) / self.parent.height)}
            do_default_tab: False

            TabbedPanelItem:
                color: text_color2 if MainMenuTabbedPanel.current_tab == self else text_color_white
                background_color: color1_rgba if MainMenuTabbedPanel.current_tab == self else clear_color
                background_normal: ""
                background_down: ""
                text: 'Session'
                GridLayout:
                    canvas:
                        Color:
                            rgb: color1
                            a: 1
                        Rectangle:
                            size: self.size
                            pos: self.pos
                    rows: 1
                    WorkspaceScreenTopTabBarItem:
                        size_hint_x: None
                        width: MainMenuTabbedPanel.element_default_width
                        label_text: "New"
                        image_source: 'Libs/Resources/new.png'
                        on_press: root.new_session_button_pressed()
                    WorkspaceScreenTopTabBarItem:
                        size_hint_x: None
                        width: MainMenuTabbedPanel.element_default_width
                        label_text: "Open"
                        image_source: 'Libs/Resources/open.png'
                        on_press: root.open_session_button_pressed()

                    WorkspaceScreenTopTabBarItem:
                        size_hint_x: None
                        width: MainMenuTabbedPanel.element_default_width
                        label_text: "Save"
                        image_source: 'Libs/Resources/save.png'
                        on_press: root.save_session_button_pressed()
                    WorkspaceScreenTopTabBarItem:
                        size_hint_x: None
                        width: MainMenuTabbedPanel.element_default_width
                        label_text: "Add to library"
                        image_source: 'Libs/Resources/addToLibrary.png'
                        on_press: root.add_to_library_button_pressed()

            TabbedPanelItem:
                color: text_color2 if MainMenuTabbedPanel.current_tab == self else text_color_white
                background_color: color1_rgba if MainMenuTabbedPanel.current_tab == self else clear_color
                background_normal: ""
                background_down: ""
                text: 'View'
                AnchorLayout:
                    canvas:
                        Color:
                            rgb: color1
                            a:1
                        Rectangle:
                            size: self.size
                            pos: self.pos
                    anchor_x: 'right'
                    anchor_y: 'center'
                    BoxLayout:
                        size_hint: None, .5
                        width: MainMenuTabbedPanel.element_default_width + ((MainMenuTabbedPanel.element_default_width / 2) * 0.75)
                        orientation: "horizontal"
                        Button:
                            highlight: True
                            size_hint: None, 1
                            background_normal: ''
                            background_down: ''
                            background_color: (0.4, .75, .83, 1) if self.highlight else (0.3, 0.15, 0, 0)
                            width: MainMenuTabbedPanel.element_default_width/2
                            on_press: self.highlight = not self.highlight; LeftTabbedPanel.opacity = 1 if self.highlight else 0
                            RelativeLayout:
                                pos: self.parent.pos
                                size: self.parent.size
                                Image:
                                    size: self.parent.size
                                    source: 'Libs/Resources/left_switcher.png'
                        Button:
                            highlight: True
                            size_hint: None, 1
                            background_normal: ''
                            background_down: ''
                            background_color: (0.4, .75, .83, 1) if self.highlight else (0.3, 0.15, 0, 0)
                            width: MainMenuTabbedPanel.element_default_width/2
                            on_press: self.highlight = not self.highlight; RightTabbedPanel.opacity = 1 if self.highlight else 0
                            RelativeLayout:
                                pos: self.parent.pos
                                size: self.parent.size
                                Image:
                                    size_hint: 1, 1
                                    source: 'Libs/Resources/right_switcher.png'
            TabbedPanelItem:
                color: text_color2 if MainMenuTabbedPanel.current_tab == self else text_color_white
                background_color: color1_rgba if MainMenuTabbedPanel.current_tab == self else clear_color
                background_normal: ""
                background_down: ""
                text: 'Help'
                GridLayout:
                    canvas:
                        Color:
                            rgb: color1
                            a:1
                        Rectangle:
                            size: self.size
                            pos: self.pos

                    rows: 1


        #LeftPanel
        AnchorLayout:
            anchor_x: 'left'
            anchor_y: 'bottom'
            TabbedPanel:
                canvas:
                    Color:
                        rgb: color_silver_light
                        a: 1
                    Rectangle:
                        size: self.size
                        pos: self.pos
                id: LeftTabbedPanel
                do_default_tab: False
                x: self.parent.x
                y: 0
                size_hint: None, None
                height: (self.parent.height - MainMenuTabbedPanel.height)
                width: sp(250)
                tab_height: sp(32)
                tab_width: self.tab_height
                tab_pos: 'top_mid'

                TabbedPanelItem:
                    background_normal: 'Libs/Resources/medialibrary_tab_icon.png'
                    background_down: 'Libs/Resources/medialibrary_tab_icon.png'
                    canvas.before:
                        Color:
                            rgba: color2_rgba if self.state == "down" else clear_color
                        Rectangle:
                            size: self.size
                            pos: self.pos
                    border: 0, 0, 0, 0
                    BoxLayout:
                        orientation: "vertical"
                        WorkspaceScreenMediaLibraryRecycleView:
                            id: WorkspaceScreenMediaLibraryRecycleViewID
                            size_hint: 1, (1 - MediaLibrarySearchBar.height/self.parent.height)
                            data: root.mediaLibraryShowData
                        JSearchBar:
                            id:MediaLibrarySearchBar
                            size_hint: 1, None
                            height: sp(28)
                            hint_text: "Filter"
                            on_search_text: root._filer_medialibrary_tab_data(self.search_text)


                TabbedPanelItem:
                    background_normal: 'Libs/Resources/workspace_segment_tab_icon.png'
                    background_down: 'Libs/Resources/workspace_segment_tab_icon.png'
                    border: 0, 0, 0, 0
                    canvas.before:
                        Color:
                            rgba: color2_rgba if self.state == "down" else clear_color
                        Rectangle:
                            size: self.size
                            pos: self.pos
                    BoxLayout:
                        orientation: "vertical"
                        WorkspaceScreenSegmentsRecycleView:
                            size_hint: 1, (1 - SegmentsLibrarySearchBar.height/self.parent.height)
                        JSearchBar:
                            id:SegmentsLibrarySearchBar
                            size_hint: 1, None
                            height: sp(28)
                            hint_text: "Filter"
                            on_search_text: root._filter_segments_tab_data(self.search_text)
        # right panel
        AnchorLayout:
            anchor_x: 'right'
            anchor_y: 'bottom'
            TabbedPanel:
                id: RightTabbedPanel
                do_default_tab: False
                y: 0
                size_hint: None, None
                height: (self.parent.height - MainMenuTabbedPanel.height)
                width: sp(250)
                canvas:
                    Color:
                        rgb: color_silver_light
                        a: 1
                    Rectangle:
                        size: self.size
                        pos: self.pos
                tab_height: sp(32)
                tab_width: self.tab_height
                tab_pos: 'top_mid'
                TabbedPanelItem:
                    # patient info tab
                    background_normal: 'Libs/Resources/workspace_patient_info_tab_icon.png'
                    background_down: 'Libs/Resources/workspace_patient_info_tab_icon.png'
                    canvas.before:
                        Color:
                            rgba: color2_rgba if self.state == "down" else clear_color
                        Rectangle:
                            size: self.size
                            pos: self.pos
                    border: 0, 0, 0, 0
                    BoxLayout:
                        orientation: "vertical"
                        RecycleView:
                            canvas.before:
                                Color:
                                    rgb: color1
                                    a: 1
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                            viewclass: 'WorkspaceScreenPatientInfoListItemView'
                            data : [{'name': "patient attr#" + str(x), 'description': "description #" + str(x), 'index_path': x} for x in range(10)]
                            RecycleBoxLayout:
                                default_size: None, sp(40)
                                default_size_hint: 1, None
                                size_hint_y: None
                                height: self.minimum_height
                                orientation: 'vertical'
                TabbedPanelItem:
                    # MRI info tab
                    background_normal: 'Libs/Resources/workspace_mri_info_tab_icon.png'
                    background_down: 'Libs/Resources/workspace_mri_info_tab_icon.png'
                    canvas.before:
                        Color:
                            rgba: color2_rgba if self.state == "down" else clear_color
                        Rectangle:
                            size: self.size
                            pos: self.pos
                    border: 0, 0, 0, 0
                    BoxLayout:
                        orientation: "vertical"
                        RecycleView:
                            canvas.before:
                                Color:
                                    rgb: color1
                                    a: 1
                                Rectangle:
                                    size: self.size
                                    pos: self.pos
                            viewclass: 'WorkspaceScreenMRIInfoListItemView'
                            data : [{'name': "MRI attr#" + str(x), 'description': "description #" + str(x), 'index_path': x} for x in range(10)]
                            RecycleBoxLayout:
                                default_size: None, sp(40)
                                default_size_hint: 1, None
                                size_hint_y: None
                                height: self.minimum_height
                                orientation: 'vertical'


        #Center panel
        AnchorLayout:
            canvas:
                Color:
                    #rgba: 0.4, .75, .83, 1
                    rgba: 0, 0, 0, 1
                Rectangle:
                    size: self.size
                    pos: self.pos
            size_hint: None, None
            anchor_x: 'left'
            anchor_y: 'bottom'
            x: 0 + LeftTabbedPanel.right if LeftTabbedPanel.opacity else 0
            y: 0
            height: (self.parent.height - MainMenuTabbedPanel.height)
            width: self.parent.width - (LeftTabbedPanel.width if LeftTabbedPanel.opacity else 0) - (RightTabbedPanel.width if RightTabbedPanel.opacity else 0)
            Image:
                size_hint: 1, 1
                source: "Libs/Resources/brain1.png"

